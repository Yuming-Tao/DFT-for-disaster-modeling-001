# 项目简介

本仓库实现了本研究中提出的灾害因子动态演化框架的计算工作流。借鉴密度泛函理论的概念，我们以灾害因子密度作为核心状态变量，将外部驱动因素（如降水）与内部脆弱性场（地形、基础设施、社会经济指标）统一到单一数学框架中。本研究由 Tao Y.M.、Wang C.M. 等人开展，手稿已完成定稿，正准备提交至国际期刊。

# 研究背景

在引入 “灾害因子” 概念后，本项目将灾害模型划分为三部分：**外部冲击（外场）**、**内部偏好（内场）** 与**密度泛函**三大模块，具体功能如下：



*   外场：刻画 “何时发生” 与 “注入多少” 的时间注入强度；

*   内场：以脆弱性为核心，反映区域对灾害因子的吸引与聚集能力；

*   两者通过非齐次泊松过程（NHPP）驱动灾害因子的时空演化，并由密度泛函表征其协同效应。

# 项目构成

本项目由 5 个主要文件夹构成，各文件夹的定位与关联如下：



1.  **核心文件夹**：人口脆弱性、地理脆弱性、供应链脆弱性、综合脆弱性、密度泛函理论；

2.  **数据关联**：综合脆弱性由 “人口脆弱性 + 地理脆弱性 + 供应链脆弱性” 整合生成，作为内场使用；

3.  **功能分工**：密度泛函理论文件夹包含外场与 NHPP 的实现代码；

4.  **核心侧重**：项目主要功能聚焦内场构建 —— 内场以脆弱性为核心，按地理栅格聚合不同要素系统的脆弱性，通过栅格数值表征对灾害因子的吸引力（空间偏好）。该聚合过程实现了多要素系统的耦合，缓解了传统方法在跨域集成与量纲一致性方面的局限。

# 项目详解

## 1. 地理脆弱性



| 文件名                          | 作用                         |
| ---------------------------- | -------------------------- |
| DEM data preprocessing.py    | 预处理 DEM 数据，生成郑州市标准化高程数据集   |
| OSM visualization display.py | 可视化 OSM 数据，生成带边界和底图的综合结果   |
| river\_potential\_field.py   | 计算河道要素势场，提供河道风险量化数据        |
| soil\_potential\_field.py    | 将土壤渗透率转换为脆弱性分布，提供土壤要素数据    |
| terrain\_potential\_field.py | 基于 DEM 计算地形势场，完成地形脆弱性评估    |
| merge\_potential\_fields.py  | 整合地形、河道、土壤势场，生成区域综合脆弱性评估结果 |
| descriptive statistics.py    | 对聚合数据按方向进行统计分析与可视化         |

## 2. 供应链脆弱性



| 文件名称              | 作用                                     |
| ----------------- | -------------------------------------- |
| config.py         | 存储并通过函数统一提供高德 API 密钥，避免密钥硬编码           |
| data\_loader.py   | 从高德 API 获取郑州暴雨易受影响行业企业数据，生成供应链关系并缓存    |
| geo\_processor.py | 处理地理空间数据（加载网格、计算距离矩阵、地理编码），支持缓存优化      |
| integrator.py     | 将企业脆弱性聚合到地理网格，补全空网格风险，输出结果             |
| main.py           | 调度全流程（加载数据→算脆弱性→整合→可视化），支持缓存控制与日志输出    |
| supply\_chain.py  | 构建供应链网络，计算企业 PageRank 重要度与归一化脆弱性（0\~1） |

## 3. 人口脆弱性



| 文件名          | 作用                                                        |
| ------------ | --------------------------------------------------------- |
| 流动脆弱性评估.py   | 计算流动脆弱性指数（结合出行数据、时序分析、空间关联分析），可视化脆弱性地图与描述性统计              |
| 网格流量数据.py    | 加载出行数据并清洗，计算网格小时级流量及时序指标（负荷率、峰均比等），结合空间分析计算脆弱性指数，导出结果     |
| 数据可视化.py     | 加载清洗人口热力 / 出行 / 网格数据、计算有效 OD 对，生成热力图、时间趋势图、OD 流图、时段对比图并保存 |
| 人口分布脆弱性评估.py | 计算人口分布脆弱性指数，可视化脆弱性地图与共享纵轴直方图                              |

## 4. 综合脆弱性



| 文件名        | 作用                                                            |
| ---------- | ------------------------------------------------------------- |
| 综合脆弱性势场.py | 融合供应链、人口分布、流动、地理四类脆弱性网格数据，自动识别字段并归一化，通过线性权重融合后二次归一化，输出综合脆弱性结果 |
| 聚类热图.py    | 基于综合脆弱性数据，推断网格行列，处理缺失值后进行聚类，生成含左侧行聚类树状图、顶部列聚类树状图的网格热力图        |

## 5. 密度泛函理论



| 文件名       | 作用                                                                                                              |
| --------- | --------------------------------------------------------------------------------------------------------------- |
| 灾害因子密度.py | 基于 NHPP（非齐次泊松过程）和蒙特卡洛方法模拟灾害因子的空间分布；生成对应的空间面板图；计算衰减库存并生成其空间面板图；统计库存面板每帧的网格聚合数据（均值、标准差、分位数等）并导出为 CSV 文件           |
| 外场输入.py   | 生成校准的模拟降雨强度时间序列（含背景雨和脉冲叠加），通过直接映射将降雨强度转换为灾害因子到达率；导出 5 分钟分辨率和小时级时间序列数据（其中小时级数据供 “灾害因子密度.py” 使用）；绘制降雨强度与到达率的时间序列图 |

# 数据来源



| 数据类型     | 数据来源                                                                                                                                  | 核心用途                                              | 关联代码文件                                                       |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- | ------------------------------------------------------------ |
| DEM 数据   | 原始分幅 DEM 文件（地理空间数据云，[https://www.gscloud.cn](https://www.gscloud.cn)）                                                                 | 生成郑州市标准化高程数据集，量化地形特征（海拔、坡度、汇水面积），构建地形风险势场         | DEM data preprocessing.py、terrain\_potential\_field.py       |
| 行政区域划分文件 | 官方地理数据平台获取的矢量文件（国家地理信息公共服务平台，[https://www.tianditu.gov.cn](https://www.tianditu.gov.cn)，SHP/GeoJSON 格式，含郑州市行政边界）                      | 界定分析区域范围，辅助空间数据裁剪、边界可视化，作为网格划分参考依据                | （无单独对应代码，辅助 DEM 预处理、OSM 可视化等，如 OSM visualization display.py） |
| 企业数据     | 1. 高德地图开放平台 API（爬取郑州暴雨易受影响行业 POI，含名称、坐标、类型，[https://lbs.amap.com](https://lbs.amap.com)）2. 本地缓存文件（data\_cache/enterprises.csv）        | 构建供应链网络节点，推断企业供应链端口（生产 / 制造 / 运输 / 消费端），计算企业脆弱性   | data\_loader.py、supply\_chain.py、integrator.py               |
| OSM 数据   | OSM 开放数据集（如河南省 OSM 数据文件夹，含 POIs、roads 等图层，[https://www.openstreetmap.org/](https://www.openstreetmap.org/)）                           | 提取 POIs 推断网格功能类型（商业 / 公共 / 交通等），计算道路密度，辅助脆弱性评估    | 人口分布脆弱性评估.py（load\_osm\_layers 函数）                           |
| 人口脆弱性数据  | 1. 人口分布数据：人口热力.csv（来源：智慧足迹大数据平台，[http://www.smartsteps.com/](http://www.smartsteps.com/)，如移动设备信令）2. 人口流动数据：人口出行.csv（来自交通刷卡、手机轨迹等）注：受限于隐私和政策，该部分数据无法公开获取，需要与数据供应商（http://www.smartsteps.com/）联系 | 计算人口分布脆弱性（暴露度、敏感性）、流动脆弱性（流量时序特征、空间关联），生成人口相关脆弱性指数 | 人口分布脆弱性评估.py、流动脆弱性评估.py、网格流量数据.py、数据可视化.py                   |

# 声明

本项目采用 Python 编写。由于开发团队核心背景为研究领域（非计算机/软件工程专业），代码编写以“实现研究核心功能、保证结果可复现”为首要目标，因此在代码的工程化细节（如模块化设计、性能优化等）上可能存在提升空间。

若您在使用过程中发现可改进之处，非常欢迎通过 Issue 或 Pull Request 提出建议，助力项目进一步完善。

